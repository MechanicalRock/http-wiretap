service:
  name: wiretap-spike-test-infra

plugins:
  - serverless-webpack

provider:
  name: aws
  runtime: nodejs8.10

functions:
  getOk:
    handler: build/handler.getOk
    events:
      - http:
          method: get
          path: downstream/ok

  getNotFound:
    handler: build/handler.getNotFound
    events:
      - http:
          method: get
          path: downstream/not-found

  postCreated:
    handler: build/handler.postCreated
    events:
      - http:
          method: post
          path: downstream/created

  postServerError:
    handler: build/handler.postServerError
    events:
      - http:
          method: post
          path: downstream/server-error

  getSlowReply:
    handler: build/handler.getSlowReply
    timeout: 30
    events:
      - http:
          method: get
          path: downstream/slow-reply

  getFixedBody:
    handler: build/handler.getFixedBody
    events:
      - http:
          method: get
          path: downstream/fixed-body

  postRelayBack:
    handler: build/handler.postRelayBack
    events:
      - http:
          method: post
          path: downstream/relay-back

resources:
  Outputs:
    serviceUrl:
      Value:
        Fn::Join:
          - ""
          - - "https://"
            - Ref: ApiGatewayRestApi
            - ".execute-api.${self:provider.region}.amazonaws.com/${self:provider.stage}/downstream"
